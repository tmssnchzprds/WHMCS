function VMBOX(e,t){this.Status="",this.IsSuspended=!1,this.Username=t&&t.Username?t.Username:"root/Administrator",this.Password=t&&t.Password?t.Password:i18n.Translate("Unknown"),this.IpAddress=t&&t.IpAddress?t.IpAddress:i18n.Translate("Unknown"),this.OsType="",this.TemplateName="",this.OsLogo="",this.Hostname="",this.UptimeSeconds=0,this._defaultActionsHTML=document.getElementById("serverActions").innerHTML,this._actionInProgress=-1,this._isActionDetailsForcedToClosed=!1,this._DoIfNoActionInProgress=(e=>{e="function"==typeof e?e:()=>{},1==this._actionInProgress?this.OpenActionDetails():e()}),this._getVmScreenshotTimeoutId=0,this._getMonitoringDataTimeoutId=0,this._OpenedTab="",this._OpenedUsageType="",this.IsoFiles=[],this.IsoSelect=null,this.SelectedIsoId=null,this.PlanTemplates=[],this.PlanTemplateSelect=null,this.SelectedPlanTemplate=null,this.onPanelDetailsChanged=(e=>{var t=JSON.parse(e);this.onStatusChanged(t.Status),this.onServiceSuspendedChanged(t.IsSuspended),this.onPasswordChanged(t.OsPassword),this.onIpAddressChanged(t.IpAddress),this.onOsTypeChanged(t.OsType,t.TemplateName),this.onHostnameChanged(t.Hostname),this.onUptimeChanged(t.UptimeSeconds),this.onActionsChanged(t.Actions)}),this.onPanelScriptsChanged=(e=>{var t=JSON.parse(e);t.Scripts&&Set_Vmbox_Scripts(t.Scripts)}),this.onStatusChanged=(e=>{if(this.Status===e)return!1;var t="#000";switch("PoweredOn"==e?(EnableElementById("wmks"),ShowElementById("remoteConnection")):(DisableElementById("wmks"),HideElementById("remoteConnection")),e){case"Registered":case"Deployed":t="#00c";break;case"PoweredOn":t="#0c0";break;case"PoweredOff":t="#e00";break;case"VmSuspended":t="#ee0";break;case"Deleted":t="#505";break;case"NotFound":t="#000";break;case"Terminated":case"Pending for PowerOn":case"Pending for PowerOff":case"Pending for PowerReset":case"Pending for InsertISO":case"Pending for EjectISO":case"Pending for VmSuspend":case"Pending for Delete":case"Pending for Deploy":case"Pending for SetupOS":t="#aaa";break;default:t="#aaa"}return document.getElementById("serverStatus").innerHTML=i18n.Translate(e),document.getElementById("serverStatus").style.color=t,"PoweredOn"===e||"PoweredOn"===this.Status&&e.startsWith("Pending")?this.GetVmScreenshot():0!==this._getVmScreenshotTimeoutId&&(clearTimeout(this._getVmScreenshotTimeoutId),this._getVmScreenshotTimeoutId=0),this.Status=e,!0}),this.onServiceSuspendedChanged=(e=>this.IsSuspended!==e&&(e?ShowMessage(i18n.Translate("Service is suspended!"),"warning"):document.getElementById("vmb_panel_msg").classList.add("hidden"),!0)),this.onPasswordChanged=(e=>this.Password!==e&&(this.Password=e,!0)),this.onIpAddressChanged=(e=>"Not Assigned"!==e&&this.IpAddress!==e&&(this.IpAddress=e,document.getElementById("serverIpAddress").innerHTML=e,!0)),this.onOsTypeChanged=((e,t)=>{if(this.OsType===e&&this.TemplateName===t)return!1;if(this.OsType=e,this.TemplateName=t,document.getElementById("templateName").innerHTML=this.TemplateName,OsLogos&&OsTags){var s="";if(OsTags[t])s=OsTags[t];else if(OsTags[e])s=OsTags[e];else{if(!OsLogos.other)return!0;s=OsLogos.other}this.OsLogo!==s&&(this.OsLogo=s,document.getElementById("OsLogo").src=this.OsLogo)}return!0}),this.onHostnameChanged=(e=>this.Hostname!==e&&(this.Hostname=e,document.getElementById("serverHostname").innerHTML=this.Hostname,!0)),this.onUptimeChanged=(e=>{if(this.UptimeSeconds===e)return!1;this.UptimeSeconds=e;var t="-";if(e<60)t=`${e}s`;else if(e<3600)t=`${parseInt(e/60)}m ${e%60}s`;else if(e<86400)t=`${parseInt(e/3600)}h ${parseInt(e/60)%60}m`;else{var s=parseInt(e/86400),n=parseInt(e/3600)%24;t=`${s} day${s>1?"s":""} and ${n} hour${n>1?"s":""}`}return document.getElementById("serverUptime").innerHTML=t,!0}),this.onActionsChanged=(e=>{document.getElementById("serverActions").innerHTML=this._defaultActionsHTML,"PoweredOn"==this.Status?(EnableElementById("wmks"),ShowElementById("remoteConnection")):(DisableElementById("wmks"),HideElementById("remoteConnection")),HideElementById("OsInstallation"),HideElementById("InsertISO"),HideElementById("EjectISO"),e.forEach(e=>{var t=document.createElement("img");switch(t.id=e,t.dataset.action=e,t.classList.add("serverAction"),t.classList.add("otherServerAction"),e){case"PowerOn":return EnableElementById("pwrOn"),void(document.getElementById("pwrOn").onclick=(e=>{this._DoIfNoActionInProgress(()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("PowerOn")})}));case"PowerOff":return EnableElementById("pwrOff"),void(document.getElementById("pwrOff").onclick=(e=>{this._DoIfNoActionInProgress(()=>{this.OpenConfirmBox(i18n.Translate("You are about to Power off your server..."),()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("PowerOff")})})}));case"PowerReset":return EnableElementById("pwrRst"),void(document.getElementById("pwrRst").onclick=(e=>{this._DoIfNoActionInProgress(()=>{this.OpenConfirmBox(i18n.Translate("You are about to Restart your server..."),()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("PowerReset")})})}));case"VmSuspend":return EnableElementById("vmSuspend"),void(document.getElementById("vmSuspend").onclick=(e=>{this._DoIfNoActionInProgress(()=>{this.OpenConfirmBox(i18n.Translate("You are about to Suspend (Hibernate) your server..."),()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("VmSuspend")})})}));case"EditPlanTemplate":return ShowElementById("OsInstallation"),this._sendObject({Type:"GetPlanTemplates"}),void(document.getElementById("OsInstallation").onclick=(e=>{if(1==this._actionInProgress)this.OpenActionDetails();else{if(!this.PlanTemplates||"number"!=typeof this.PlanTemplates.length||this.PlanTemplates.length<1)return void alert(i18n.Translate("No OS Templates available now."));this.OpenConfirmBox(this.PlanTemplateSelect,()=>{!this.PlanTemplateSelect.selectedOptions||this.PlanTemplateSelect.selectedOptions.length<1||"null"==this.PlanTemplateSelect.selectedOptions[0].value?alert(i18n.Translate("Please select a Template first.")):(this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendObject({Type:"EditPlanTemplate",Param:this.PlanTemplateSelect.selectedOptions[0].value}))},{title:i18n.Translate("Select OS Template..."),yesBtnText:i18n.Translate("Install Selected"),noBtnText:i18n.Translate("Cancel")})}}));case"InsertIso":return ShowElementById("InsertISO"),this._sendObject({Type:"GetCdDrives"}),void(document.getElementById("InsertISO").onclick=(e=>{if(1==this._actionInProgress)this.OpenActionDetails();else{if(!this.IsoFiles||"number"!=typeof this.IsoFiles.length||this.IsoFiles.length<1)return void alert(i18n.Translate("No ISO files available now."));this.OpenConfirmBox(this.IsoSelect,()=>{!this.IsoSelect.selectedOptions||this.IsoSelect.selectedOptions.length<1||"null"==this.IsoSelect.selectedOptions[0].value?alert(i18n.Translate("Please select a ISO file first.")):(this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendObject({Type:"InsertISO",Param:this.IsoSelect.selectedOptions[0].value}))},{title:i18n.Translate("Select ISO file..."),yesBtnText:i18n.Translate("Insert Selected"),noBtnText:i18n.Translate("Cancel")})}}));case"EjectIso":return ShowElementById("EjectISO"),void(document.getElementById("EjectISO").onclick=(e=>{this._DoIfNoActionInProgress(()=>{this.OpenConfirmBox(i18n.Translate("You are about to eject cd-rom devices from your server..."),()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("EjectISO")})})}));case"Delete":t.innerHTML=i18n.Translate("Delete"),t.classList.add("red"),t.onclick=(e=>{1==this._actionInProgress?this.OpenActionDetails():this.OpenConfirmBox("شما در حال حذف سرور هستید",()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("Delete")})});break;case"Deploy":t.innerHTML=i18n.Translate("Deploy"),t.classList.add("blue"),t.onclick=(e=>{1==this._actionInProgress?this.OpenActionDetails():this.OpenConfirmBox("شما در حال راه اندازی مجدد سرور هستید",()=>{this._actionInProgress=!0,this._isActionDetailsForcedToClosed=!1,this._sendCommand("Deploy")})});break;default:return}document.getElementById("serverActions").appendChild(t)})}),this.HandleMessage=(e=>{if(e.code&&"number"==typeof e.code){switch(e.code){case 400:alert(i18n.Translate("Operation failed."))}console.log(e.content)}}),this.HandleAction=(e=>{if(e.steps){this._isActionDetailsForcedToClosed||this.OpenActionDetails(e.name);var t=document.querySelector("#actionDetailsModal #modalName");t&&(t.innerHTML=e.name);var s=document.querySelector("#actionDetailsModal #modalContent");s||(s=document.createElement("div")),s.innerHTML="";var n=!0;if(e.steps.forEach((e,t)=>{e.done||(n=!1);var i=document.createElement("div");i.id="Act"+t,i.classList.add("action-row");var a="";if(e.done){var o=document.createElement("img");o.id="ActDone"+t,o.classList.add("doneActionIcon"),o.style.padding="7px",o.style.width="36px",o.src="modules/servers/vmbox/assets/checked.png",i.appendChild(o)}else if(e.percentage>=0){a=" "+e.percentage+"%",(r=document.createElement("div")).id="ActLoading"+t,r.classList.add("laloader"),i.appendChild(r)}else{var r;(r=document.createElement("div")).id="ActWaiting"+t,r.classList.add("laloader"),r.style.opacity=0,i.appendChild(r)}var l=document.createElement("div");l.id="StepName"+t,l.classList.add("action-step"),l.innerHTML=i18n.Translate(e.name)+a,i.appendChild(l),s.appendChild(i)}),n){this._actionInProgress=!1;var i=document.createElement("div");i.id="CloseDiv",i.classList.add("action-row");var a=document.createElement("button");a.style.margin="auto",a.innerHTML=i18n.Translate("Close"),a.onclick=(()=>{this.CloseActionDetails()}),i.appendChild(a),s.appendChild(i)}}}),this.HandlePlanTemplatesList=(e=>{PlnTmplts=JSON.parse(e),"number"==typeof PlnTmplts.length&&(this.PlanTemplateSelect=document.createElement("select"),this.PlanTemplateSelect.style.width="100%",this.PlanTemplateSelect.options[this.PlanTemplateSelect.options.length]=new Option(i18n.Translate("Select an Option..."),"null",!0,!0),PlnTmplts.forEach(e=>{var t=new Option(e.Name,e.Id,!1,!1);this.PlanTemplateSelect.options[this.PlanTemplateSelect.options.length]=t}),this.PlanTemplates=PlnTmplts)}),this.HandleCdDrivesList=(e=>{Drives=JSON.parse(e),"number"==typeof Drives.length&&(this.IsoSelect=document.createElement("select"),this.IsoSelect.style.width="100%",this.IsoSelect.options[this.IsoSelect.options.length]=new Option(i18n.Translate("Select an Option..."),"null",!0,!0),Drives.forEach(e=>{var t=new Option(e.Name,e.Id,!1,!1);this.IsoSelect.options[this.IsoSelect.options.length]=t}),this.IsoFiles=Drives)}),this.HandleVmScreenshot=(e=>{if(e.startsWith('{"')){var t=JSON.parse(e);t.err&&("VM is not PoweredOn"===t.err||"VM is not Deployed"===t.err||console.log("Error on getting vm screenshot"))}else document.getElementById("screenShot").src=`data:image/png;base64,${e}`;0!==this._getVmScreenshotTimeoutId&&(clearTimeout(this._getVmScreenshotTimeoutId),this._getVmScreenshotTimeoutId=0),this._getVmScreenshotTimeoutId=setTimeout(this.GetVmScreenshot,RELOAD_SCREENSHOT_INTERVAL||5e3)}),this.HandleMonitoringData=(e=>{var t=JSON.parse(e);UpdateGaugeBar("cpu_chart","CPU Usage",1024*t.OverallCpuUsage,1024*t.MaxCpuUsage,"Hz"),UpdateGaugeBar("ram_chart","Ram Usage",1024*t.GuestMemoryUsage,1024*t.MaxMemoryUsage,"B");var s=(""+t.PerformanceType).split(":")[0],n="",i="";-1!==s.indexOf("cpu")?(n="CPU Usage",i="CPU Usage"):-1!==s.indexOf("ram")&&(n="RAM Usage",i="RAM Usage"),UpdateLineGraph(s,n,t.Performance,i),0!==this._getMonitoringDataTimeoutId&&(clearTimeout(this._getMonitoringDataTimeoutId),this._getMonitoringDataTimeoutId=0),"Monitoring"===this._OpenedTab&&(this._getMonitoringDataTimeoutId=setTimeout(this.GetMonitoringData,RELOAD_MONITORING_INTERVAL||5e3))}),this._sendObject=(e=>!!this.conn&&("object"==typeof e&&(this.conn.send(JSON.stringify(e)),!0))),this._sendCommand=(e=>this._sendObject({Type:e})),this._reloadDetails=(()=>{this._sendObject({Type:"GetPanelDetails"})}),this._reloadScripts=(()=>{this._sendObject({Type:"GetPanelScripts"})}),this._parseIncomingCommand=(e=>{if(e&&e.type)switch(e.type){case"SetPanelDetails":this.onPanelDetailsChanged(e.data);break;case"SetPanelScripts":this.onPanelScriptsChanged(e.data);break;case"ExecScriptResult":window.onExecScriptResult&&window.onExecScriptResult(e.data);break;case"ExecScriptUpdate":window.onExecScriptUpdate&&window.onExecScriptUpdate(e.data);break;case"SetStatus":this.onStatusChanged(e.data);break;case"SetServiceSuspended":this.onServiceSuspendedChanged("true"===e.data);break;case"SetOsPassword":this.onPasswordChanged(e.data);break;case"SetIpAddress":this.onIpAddressChanged(e.data);break;case"SetActions":var t=e.data.split(",");this.onActionsChanged(t);break;case"Reload":this._reloadDetails();break;case"Message":this.HandleMessage(e.data);break;case"Action":this.HandleAction(e.data);break;case"SetCdDrives":this.HandleCdDrivesList(e.data);break;case"SetPlanTemplates":this.HandlePlanTemplatesList(e.data);break;case"SetVmScreenshot":this.HandleVmScreenshot(e.data);break;case"SetMonitoringData":this.HandleMonitoringData(e.data)}}),this.onConnectionLost=(e=>{ShowMessage(i18n.Translate("Connection Lost, Please try again...")),DEBUG&&console.log("WebSocket Closed, Event:",e)}),this.onConnectionEstablished=(e=>{document.getElementById("vmb_panel_msg").classList.add("hidden"),this._reloadDetails(),setInterval(this._reloadDetails,RELOAD_PANEL_INTERVAL||5e4),this._reloadScripts(),setInterval(this._reloadScripts,RELOAD_SCRIPTS_INTERVAL||3e4),window.ExecScript&&(window.ExecScript=((e,t)=>{var s={ScriptId:e,Params:t};this._sendObject({Type:"ExecScript",Param:`${JSON.stringify(s)}`})}),window.CancelScript=(e=>{this._sendObject({Type:"CancelScript",Param:`${e}`})}))}),this.Setup=(()=>{window.WebSocket?(ShowMessage(i18n.Translate("Connecting to Panel...","info")),this.conn=new WebSocket(e),this.conn.onclose=(e=>{this.onConnectionLost(e)}),this.conn.onopen=(e=>{this.onConnectionEstablished(e)}),this.conn.onmessage=(e=>{try{JSON.parse(e.data).forEach(e=>{this._parseIncomingCommand(e)})}catch{}})):alert("Sorry, your browser doesn't support websocket, please contact service provider")}),this.GetVmScreenshot=(()=>{this._sendObject({Type:"GetVmScreenshot"})}),this.GetMonitoringData=(()=>{var e="RealTime",t=document.getElementById(`${this._OpenedUsageType}TimeSpan`);t&&t.selectedOptions&&t.selectedOptions.length>0&&"null"!==t.selectedOptions[0].value&&(e=t.selectedOptions[0].value),this._sendObject({Type:"GetMonitoringData",Param:`${this._OpenedUsageType}:${e}`}),0!==this._getVmScreenshotTimeoutId&&(this._getVmScreenshotTimeoutId=0)}),this.OpenServerVnc=(()=>{"PoweredOn"===this.Status?window.open(window.location.href+"&console=novnc","_blank"):alert(i18n.Translate("Server is not ready or Powered On"))}),this.OpenServerConsole=(()=>{"PoweredOn"===this.Status?window.open(window.location.href+"&console=wmks","_blank"):alert(i18n.Translate("Server is not ready or Powered On"))}),this.OpenActionDetails=(e=>{if(this._actionInProgress||-1==this._actionInProgress){var t=document.createElement("div");return OpenModal(e,t,"actionDetailsModal")}}),this.CloseActionDetails=(()=>{CloseModal("actionDetailsModal"),this._actionInProgress?this._isActionDetailsForcedToClosed=!0:this._isActionDetailsForcedToClosed=!1}),this.OpenRemoteConnection=(()=>{var e=document.createElement("iframe");e.style.width="100%",e.style.height="100%",e.style.minHeight="85vh",e.style.border="none",e.style.marginTop="-5px",e.src=window.location.href+"&console=wmks";var t=OpenModal(i18n.Translate("Remote Connection"),e,"remoteConnectionModal");t.querySelector("#modalPaper").classList.add("full-width"),t.querySelector("#modalContent").style.paddingTop="0px"}),this.OpenAccessInformation=(()=>{var e=document.createElement("div");e.style.direction="ltr",e.style.padding="15px",e.innerHTML=`<p>IP Address: ${this.IpAddress}</p><p>Username: ${this.Username}</p><p>Password: ${this.Password}</p>`,OpenModal(i18n.Translate("Access Information"),e,"accessInfo")}),this.OpenConfirmBox=((e,t,s)=>{var n=document.createElement("div"),i=document.createElement("div");i.style.padding="15px 25px","string"==typeof e?i.innerHTML=e:i.appendChild(e),n.appendChild(i);var a=document.createElement("div");a.style.display="flex",a.style.justifyContent="center",a.style.paddingBottom="10px";var o=document.createElement("button");o.classList.add("btn"),o.style.margin="5px 6px",o.innerHTML=s&&s.yesBtnText?s.yesBtnText:i18n.Translate("Yes"),o.onclick=(()=>{this.CloseConfirmBox(),t()}),a.appendChild(o);var r=document.createElement("button");r.classList.add("btn"),r.style.margin="5px 6px",r.innerHTML=s&&s.noBtnText?s.noBtnText:i18n.Translate("No"),r.onclick=(()=>this.CloseConfirmBox()),a.appendChild(r),n.appendChild(a),OpenModal(s&&s.title?s.title:i18n.Translate("Are you sure?"),n,"confirmBox")}),this.CloseConfirmBox=(()=>{CloseModal("confirmBox")})}